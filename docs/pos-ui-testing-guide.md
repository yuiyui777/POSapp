# POSレジ画面 - テストガイド

## 概要

UIimage.mdの仕様に基づいて実装されたPOSレジ画面のテスト手順です。

## テスト環境

### 前提条件
- ✅ バックエンドサーバー起動中（Port 8000）
- ✅ フロントエンドサーバー起動中（Port 3000）
- ✅ Webカメラ使用可能
- ✅ テストデータ投入済み

### アクセスURL
- **ホームページ**: http://localhost:3000
- **POSレジ画面**: http://localhost:3000/pos

---

## 画面構成（UIimage.md準拠）

### UI要素

| 番号 | 要素名 | 説明 |
|------|--------|------|
| ① | バーコードスキャンボタン | カメラを起動 |
| ② | コード表示エリア | 商品コードを表示 |
| ③ | 名称表示エリア | 商品名を表示 |
| ④ | 単価表示エリア | 商品単価を表示 |
| ⑤ | 購入リストへ追加ボタン | カートに商品を追加 |
| ⑥ | 購入品目リスト | カート内の商品一覧（名称/数量/単価/単品合計） |
| ⑦ | 購入ボタン | 購入を確定 |

---

## テストシナリオ

### シナリオ1: 基本的な購入フロー

#### Step 1: POSレジ画面を開く

```
http://localhost:3000/pos
```

**期待結果:**
- ✅ 「モバイルPOSシステム」のタイトル表示
- ✅ ① 「スキャン (カメラ)」ボタン表示
- ✅ ②③④ 空欄で「---」表示
- ✅ ⑥ 「商品がありません」と表示
- ✅ ⑦ 購入ボタンは無効（グレーアウト）

#### Step 2: カメラを起動

1. ① 「スキャン (カメラ)」ボタンをクリック
2. ブラウザからカメラの許可を求められたら「許可」

**期待結果:**
- ✅ カメラ映像が表示される
- ✅ ボタンが「スキャン中...」に変わる
- ✅ ボタンが無効化される

#### Step 3: 商品1をスキャン（ボールペン）

バーコード `4589901001018` をスキャン

**期待結果:**
- ✅ カメラが一時停止（「スキャン待機中...」）
- ✅ 「🔍 検索中...」と表示
- ✅ ② コード: `4589901001018`
- ✅ ③ 名称: `テクワン・消せるボールペン 黒`
- ✅ ④ 単価: `¥180`
- ✅ ⑤ 「追加」ボタンが有効化

#### Step 4: 購入リストに追加

⑤ 「追加」ボタンをクリック

**期待結果:**
- ✅ ②③④ が空欄（「---」）に戻る
- ✅ ⑥ 購入リストに商品が追加:
  ```
  テクワン・消せるボールペン 黒  x1  ¥180  ¥180
  ```
- ✅ 商品点数: 1 点
- ✅ 合計金額: ¥180
- ✅ ⑦ 購入ボタンが有効化（オレンジ色）

#### Step 5: 商品2をスキャン（ノート）

1. ① 「スキャン (カメラ)」ボタンを再度クリック
2. バーコード `4589901001025` をスキャン

**期待結果:**
- ✅ ② コード: `4589901001025`
- ✅ ③ 名称: `テクワン・スーパーノート B5 5冊パック`
- ✅ ④ 単価: `¥450`

#### Step 6: リストに追加

⑤ 「追加」ボタンをクリック

**期待結果:**
- ✅ ⑥ 購入リストに追加:
  ```
  テクワン・消せるボールペン 黒         x1  ¥180   ¥180
  テクワン・スーパーノート B5 5冊パック  x1  ¥450   ¥450
  ```
- ✅ 商品点数: 2 点
- ✅ 合計金額: ¥630

#### Step 7: 同じ商品を再度スキャン（ボールペン）

1. カメラを起動
2. 再度 `4589901001018` をスキャン
3. 「追加」ボタンをクリック

**期待結果:**
- ✅ ⑥ 購入リストで数量が増加:
  ```
  テクワン・消せるボールペン 黒         x2  ¥180   ¥360
  テクワン・スーパーノート B5 5冊パック  x1  ¥450   ¥450
  ```
- ✅ 商品点数: 3 点
- ✅ 合計金額: ¥810

#### Step 8: 購入を確定

⑦ 「購入」ボタンをクリック

**期待結果:**
- ✅ 確認ダイアログが表示:
  ```
  購入を確定しますか？
  
  商品点数: 3 点
  合計金額（税抜）: ¥810
  合計金額（税込）: ¥891
  ```
- ✅ 「OK」をクリック
- ✅ 完了アラートが表示:
  ```
  購入完了！
  
  合計金額（税込）: ¥891
  合計金額（税抜）: ¥810
  ```
- ✅ カートがクリアされる
- ✅ ②③④ が空欄に戻る
- ✅ ⑥ が「商品がありません」に戻る

---

### シナリオ2: エラーハンドリング

#### テスト1: 存在しない商品をスキャン

1. 存在しないバーコード `9999999999999` をスキャン

**期待結果:**
- ✅ 赤色のエラーカードが表示
- ✅ "❌ エラー: 商品が見つかりません (コード: 9999999999999)"
- ✅ ②③④ は空欄のまま
- ✅ 「追加」ボタンは表示されない

#### テスト2: API接続エラー

1. バックエンドサーバーを停止
2. バーコードをスキャン

**期待結果:**
- ✅ エラーメッセージが表示
- ✅ 購入リストは変更されない

---

### シナリオ3: 大量商品のテスト

#### 5種類の商品を各2個ずつスキャン

| 商品コード | 商品名 | 単価 | 数量 | 小計 |
|-----------|--------|------|------|------|
| 4589901001018 | ボールペン | 180円 | 2 | 360円 |
| 4589901001025 | ノート | 450円 | 2 | 900円 |
| 4589901001032 | カッター | 800円 | 2 | 1,600円 |
| 4589901001049 | 付箋 | 320円 | 2 | 640円 |
| 4589901001056 | 椅子 | 12,000円 | 2 | 24,000円 |

**期待結果:**
- ✅ 商品点数: 10 点
- ✅ 合計金額（税抜）: ¥27,500
- ✅ 合計金額（税込）: ¥30,250
- ✅ リストの表示が正しい
- ✅ スクロールが機能する

---

## 機能詳細

### 商品グループ化機能

同じ商品を複数回追加した場合、自動的にグループ化されて数量が増えます。

**例:**
```
スキャン1: ボールペン → x1 ¥180 ¥180
スキャン2: ボールペン → x2 ¥180 ¥360
スキャン3: ボールペン → x3 ¥180 ¥540
```

### 税込計算

消費税10%で自動計算されます。

**計算式:**
```
税込金額 = Math.floor(税抜金額 * 1.1)
```

### スキャナー制御

- スキャン成功後、カメラは自動的に一時停止
- 商品を追加後、再度「スキャン」ボタンで再開

---

## パフォーマンステスト

### レスポンスタイム

| 操作 | 期待時間 |
|------|---------|
| バーコードスキャン | < 1秒 |
| API応答 | < 500ms |
| 商品表示 | 即座 |
| リスト追加 | 即座 |

### 連続スキャンテスト

10個の商品を連続でスキャンして追加：

- ✅ すべて正しく追加される
- ✅ UIがフリーズしない
- ✅ 合計金額が正しい

---

## UI/UXチェック

### デザイン

- ✅ レスポンシブデザイン（モバイル対応）
- ✅ 見やすいフォントサイズ
- ✅ 明確な視覚的フィードバック
- ✅ ボタンの状態が分かりやすい

### ユーザビリティ

- ✅ ボタンが大きくて押しやすい
- ✅ エラーメッセージが分かりやすい
- ✅ ローディング状態が明確
- ✅ 商品追加後、次の操作がスムーズ

### アクセシビリティ

- ✅ 色のコントラストが十分
- ✅ ボタンのラベルが明確
- ✅ エラーが赤色で目立つ

---

## ブラウザ互換性

| ブラウザ | バージョン | 対応状況 |
|---------|-----------|---------|
| Chrome | 最新 | ✅ 完全対応 |
| Edge | 最新 | ✅ 完全対応 |
| Safari | 最新 | ✅ 完全対応 |
| Firefox | 最新 | ✅ 完全対応 |

**注意:** カメラAPIはHTTPSまたはlocalhostでのみ動作します。

---

## トラブルシューティング

### 商品が追加されない

1. ブラウザのコンソールを確認
2. ネットワークタブでAPI呼び出しを確認
3. バックエンドのログを確認

### 合計金額が合わない

- 税込/税抜の表示を確認
- 小数点以下の切り捨て処理を確認

### カメラ映像が表示されない

1. カメラの許可を確認
2. 他のアプリがカメラを使用していないか確認
3. ブラウザを再起動

---

## テストチェックリスト

### 基本機能
- [ ] カメラが起動する
- [ ] バーコードがスキャンできる
- [ ] 商品情報が表示される
- [ ] 「追加」ボタンで商品がリストに追加される
- [ ] 合計金額が正しく計算される
- [ ] 購入ボタンで確認ダイアログが表示される
- [ ] 購入完了後、カートがクリアされる

### エラー処理
- [ ] 存在しない商品でエラー表示
- [ ] API接続エラーが適切に処理される
- [ ] エラーメッセージが分かりやすい

### UI/UX
- [ ] ボタンが押しやすい
- [ ] 状態が視覚的に分かりやすい
- [ ] レスポンシブデザインが機能する
- [ ] ローディング状態が明確

### 数量管理
- [ ] 同じ商品を複数回追加できる
- [ ] 数量が正しくグループ化される
- [ ] 単品合計が正しく計算される

---

## テスト用商品データ

| 商品コード | 商品名 | 単価 | 備考 |
|-----------|--------|------|------|
| 4589901001018 | テクワン・消せるボールペン 黒 | 180円 | 低価格商品 |
| 4589901001025 | テクワン・スーパーノート B5 5冊パック | 450円 | 中価格商品 |
| 4589901001032 | ハイブリッドカッター Pro | 800円 | 中価格商品 |
| 4589901001049 | スマート付箋 5色ミックス | 320円 | 中価格商品 |
| 4589901001056 | 疲れない椅子 Alpha | 12,000円 | 高価格商品 |

---

## 計算テストケース

### ケース1: 単品購入
```
ボールペン x1 = ¥180
税抜: ¥180
税込: ¥198
```

### ケース2: 複数種類
```
ボールペン x1 = ¥180
ノート x1 = ¥450
税抜: ¥630
税込: ¥693
```

### ケース3: 同じ商品複数
```
ボールペン x3 = ¥540
税抜: ¥540
税込: ¥594
```

### ケース4: 高額商品
```
椅子 x1 = ¥12,000
税抜: ¥12,000
税込: ¥13,200
```

---

## スクリーンショット（確認ポイント）

### 1. 初期状態
- カメラ停止中
- ②③④ 空欄
- ⑥ 「商品がありません」
- ⑦ 購入ボタン無効

### 2. スキャン中
- カメラ映像表示
- スキャンボタン無効化

### 3. 商品情報表示
- ②③④ に商品情報
- ⑤ 追加ボタン有効

### 4. 商品追加後
- ⑥ にリスト表示
- グループ化された数量
- 合計金額表示

### 5. 購入確認
- 確認ダイアログ
- 税込・税抜表示

---

## バグレポート形式

バグを見つけた場合は以下の形式で報告してください：

```
【バグタイトル】

【再現手順】
1. ...
2. ...
3. ...

【期待される動作】
...

【実際の動作】
...

【環境】
- ブラウザ: Chrome 120
- OS: macOS
- 日時: 2025-10-16

【スクリーンショット】
（あれば添付）
```

---

## テスト実施記録

### 実施日: 2025-10-16
### テスター: __________

| シナリオ | 結果 | 備考 |
|---------|------|------|
| 基本的な購入フロー | ⬜ | |
| エラーハンドリング | ⬜ | |
| 大量商品テスト | ⬜ | |
| 計算の正確性 | ⬜ | |
| UI/UX | ⬜ | |

**総合評価:** ⬜ 合格 / ⬜ 不合格

**コメント:**
```


```

---

## 次のステップ

テストが完了したら：

1. ✅ バグがあれば修正
2. ✅ 購入処理のDB保存実装
3. ✅ 取引履歴機能の追加
4. ✅ レシート印刷機能の追加
5. ✅ 本番環境へのデプロイ

---

## 参考資料

- [UIimage.md](../frontend/UIimage.md) - UI仕様書
- [E2E Testing Guide](./e2e-testing-guide.md) - API疎通テスト
- [開発環境セットアップ](./development.md)

